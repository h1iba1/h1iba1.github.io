如何防止目录遍历攻击

防止文件路径遍历漏洞的最有效方法是避免将用户提供的输入完全传递给文件系统API。可以重写许多执行此操作的应用程序功能，以更安全的方式提供相同的行为。

如果认为不可避免的是将用户提供的输入传递给文件系统API，则应同时使用两层防御来防止攻击：

- 应用程序应在处理之前验证用户输入。理想情况下，验证应与允许值的白名单进行比较。如果所需的功能无法做到这一点，则验证应验证输入内容仅包含允许的内容，例如纯字母数字字符。

- 验证提供的输入后，应用程序应将输入附加到基本目录，并使用平台文件系统API规范化路径。它应验证规范化路径以预期的基本目录开头。

以下是一些简单的Java代码示例，用于根据用户输入来验证文件的规范路径：

```javascript
File file = new File(BASE_DIRECTORY, userInput);
if (file.getCanonicalPath().startsWith(BASE_DIRECTORY)) {
    // process file
```

